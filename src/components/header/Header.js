import { useEffect } from "react";
import { useLocation, Link } from "react-router-dom";


async function connect(onConnected) {
  if (!window.ethereum) {
    alert("Get MetaMask!");
    return;
  }

  const accounts = await window.ethereum.request({
    method: "eth_requestAccounts",
  });
  onConnected(accounts[0]);
}

async function checkIfWalletIsConnected(onConnected) {
  if (window.ethereum) {
    const accounts = await window.ethereum.request({
      method: "eth_accounts",
    });

    if (accounts.length > 0) {
      const account = accounts[0];
      onConnected(account);
      return;
    }

  }
}


function Header(props){

  const { search } = useLocation();


  useEffect(() => {
    checkIfWalletIsConnected(props.setUserAddress);
    const resetAccount = () => {
      props.setUserAddress('');
      checkIfWalletIsConnected(props.setUserAddress);
    }
    window.ethereum.on('accountsChanged', resetAccount);
    window.ethereum.on('disconnect', resetAccount);
    
  }, []);

    return (<header className="d-flex flex-wrap justify-content-center py-3 mb-5">
      <Link to={'/' + search} className="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-dark text-decoration-none"> 
        <span>
          <svg width="336" height="50" viewBox="0 0 336 50" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clipPath="url(#clip0_3_74)">
            <path d="M58.7675 12.6931V12.2909H65.0405C65.3293 12.2909 65.586 12.5 65.6502 12.7896L69.276 31.7085H69.4365L73.8164 12.7574C73.8805 12.4839 74.1212 12.2748 74.41 12.2748H80.4103C80.699 12.2748 80.9397 12.4678 81.0039 12.7574L85.464 31.7085H85.6244L89.2182 12.7896C89.2663 12.5 89.523 12.2909 89.8278 12.2909H96.0206V12.6931L89.7155 39.9614C89.6513 40.2349 89.4107 40.444 89.1219 40.444H81.9665C81.6777 40.444 81.421 40.2349 81.3729 39.9614L77.5545 21.8308H77.3941L73.4474 39.9614C73.3832 40.251 73.1425 40.444 72.8537 40.444H65.6983C65.4095 40.444 65.1689 40.251 65.1047 39.9614L58.7675 12.6931Z" fill="black"/>
            <path d="M98.6197 12.2909H105.069C105.294 12.2909 105.502 12.4035 105.599 12.5965L115.77 30.6628H115.931V12.9022C115.931 12.5644 116.203 12.2909 116.54 12.2909H121.562C121.899 12.2909 122.172 12.5644 122.172 12.9022V39.8166C122.172 40.1544 121.899 40.4279 121.562 40.4279H115.08C114.856 40.4279 114.663 40.3153 114.551 40.1223L104.379 22.1847H104.219V39.8166C104.219 40.1544 103.946 40.4279 103.609 40.4279H98.6197C98.2828 40.4279 98.01 40.1544 98.01 39.8166V12.9022C98.01 12.5644 98.2828 12.2909 98.6197 12.2909Z" fill="black"/>
            <path d="M125.701 12.2909H144.52C144.857 12.2909 145.13 12.5644 145.13 12.9022V17.2941C145.13 17.6319 144.857 17.9054 144.52 17.9054H131.99C131.653 17.9054 131.381 18.1789 131.381 18.5167V23.2786C131.381 23.6165 131.653 23.89 131.99 23.89H143.269C143.606 23.89 143.879 24.1634 143.879 24.5013V28.8932C143.879 29.231 143.606 29.5045 143.269 29.5045H131.99C131.653 29.5045 131.381 29.778 131.381 30.1158V39.7844C131.381 40.1223 131.108 40.3957 130.771 40.3957H125.701C125.364 40.3957 125.092 40.1223 125.092 39.7844V12.9022C125.092 12.5644 125.364 12.2909 125.701 12.2909Z" fill="black"/>
            <path d="M154.756 17.9537H147.889C147.553 17.9537 147.28 17.6802 147.28 17.3423V12.9022C147.28 12.5644 147.553 12.2909 147.889 12.2909H169.195C169.532 12.2909 169.805 12.5644 169.805 12.9022V17.3423C169.805 17.6802 169.532 17.9537 169.195 17.9537H162.329C161.992 17.9537 161.719 18.2272 161.719 18.565V39.8166C161.719 40.1544 161.446 40.4279 161.109 40.4279H156.007C155.671 40.4279 155.398 40.1544 155.398 39.8166V18.5811C155.366 18.2272 155.093 17.9537 154.756 17.9537Z" fill="black"/>
            <path d="M183.458 12.2909H189.394C189.603 12.2909 189.811 12.4035 189.924 12.5804L197.64 25.1931H197.801L205.518 12.5804C205.63 12.4035 205.823 12.2909 206.047 12.2909H211.903C212.24 12.2909 212.513 12.5644 212.513 12.9022V39.8166C212.513 40.1544 212.24 40.4279 211.903 40.4279H207.042C206.705 40.4279 206.432 40.1544 206.432 39.8166V22.2651H206.272L197.897 35.7786H197.496L189.121 22.1525H188.961V39.8327C188.961 40.1705 188.688 40.444 188.351 40.444H183.49C183.153 40.444 182.88 40.1705 182.88 39.8327V12.9022C182.848 12.5644 183.121 12.2909 183.458 12.2909Z" fill="black"/>
            <path d="M214.486 34.2021C214.486 30.3089 217.133 27.7349 222.909 27.7349C224.465 27.7349 226.551 28.0566 227.401 28.3462V26.6248C227.401 25.177 226.471 24.0508 224.193 24.0508C222.492 24.0508 221.417 24.8713 221.192 25.9492C221.144 26.2066 220.872 26.3835 220.615 26.3835H216.026C215.673 26.3835 215.369 26.0779 215.401 25.74C215.705 22.0882 218.561 19.0798 224.401 19.0798C230.129 19.0798 233.578 22.249 233.578 26.6409V39.8488C233.578 40.1866 233.305 40.4601 232.968 40.4601H228.043L227.594 38.5779H227.433C226.278 39.897 224.433 40.8301 221.818 40.8301C217.085 40.798 214.486 37.9344 214.486 34.2021ZM227.401 32.7542V32.5611C226.118 32.0463 224.834 31.8855 223.631 31.8855C221.626 31.8855 220.583 32.7703 220.583 33.8964C220.583 35.103 221.545 35.9878 223.39 35.9878C225.909 35.9717 227.401 34.4756 227.401 32.7542Z" fill="black"/>
            <path d="M236.995 19.4015H241.423C241.712 19.4015 241.953 19.5946 242.017 19.8681L242.386 21.4125H242.546C243.429 20.3829 244.68 19.5624 246.413 19.2085C251.451 18.2111 256.055 22.426 256.055 27.5901V39.8166C256.055 40.1544 255.782 40.4279 255.445 40.4279H250.504C250.167 40.4279 249.894 40.1544 249.894 39.8166V28.5232C249.894 26.11 248.819 24.6622 246.365 24.6622C244.151 24.6622 242.546 26.2387 242.546 28.7645V39.8166C242.546 40.1544 242.274 40.4279 241.937 40.4279H236.995C236.658 40.4279 236.386 40.1544 236.386 39.8166V20.0129C236.386 19.675 236.658 19.4015 236.995 19.4015Z" fill="black"/>
            <path d="M257.836 34.2021C257.836 30.3089 260.483 27.7349 266.259 27.7349C267.815 27.7349 269.901 28.0566 270.751 28.3462V26.6248C270.751 25.177 269.82 24.0508 267.542 24.0508C265.842 24.0508 264.767 24.8713 264.542 25.9492C264.494 26.2066 264.221 26.3835 263.964 26.3835H259.376C259.023 26.3835 258.718 26.0779 258.75 25.74C259.055 22.0882 261.911 19.0798 267.751 19.0798C273.478 19.0798 276.928 22.249 276.928 26.6409V39.8488C276.928 40.1866 276.655 40.4601 276.318 40.4601H271.393L270.943 38.5779H270.783C269.612 39.897 267.767 40.8301 265.168 40.8301C260.451 40.798 257.836 37.9344 257.836 34.2021ZM270.751 32.7542V32.5611C269.467 32.0463 268.184 31.8855 266.981 31.8855C264.975 31.8855 263.932 32.7703 263.932 33.8964C263.932 35.103 264.895 35.9878 266.74 35.9878C269.275 35.9717 270.751 34.4756 270.751 32.7542Z" fill="black"/>
            <path d="M280.04 42.2458H284.965C285.238 42.2458 285.447 42.4389 285.527 42.6963C285.912 43.8707 287.212 44.6911 288.912 44.6911C291.64 44.6911 293.003 43.2433 293.003 41.3449V38.417H292.843C291.848 39.6236 290.244 40.7819 287.276 40.7819C281.981 40.7819 278.773 36.1969 278.773 29.9228C278.773 23.6165 281.981 19.0316 287.276 19.0316C290.244 19.0316 291.848 20.2059 292.843 21.3964H293.003L293.501 19.8198C293.581 19.5624 293.822 19.3855 294.078 19.3855H298.554C298.891 19.3855 299.164 19.659 299.164 19.9968V41.4093C299.164 46.6699 294.752 49.9678 288.896 49.9678C283.506 49.9678 279.832 47.233 279.398 42.8733C279.382 42.5515 279.687 42.2458 280.04 42.2458ZM293.292 29.9389C293.292 27.011 292.217 24.4691 289.169 24.4691C286.121 24.4691 285.03 26.9949 285.03 29.9389C285.03 32.8829 286.024 35.3604 289.169 35.3604C292.297 35.3604 293.292 32.8668 293.292 29.9389Z" fill="black"/>
            <path d="M301.025 29.9389C301.025 23.9865 304.474 19.0476 311.293 19.0476C317.71 19.0476 321.32 23.5843 321.32 29.2954V30.9685C321.32 31.3063 321.047 31.5798 320.71 31.5798H307.988C307.635 31.5798 307.33 31.8855 307.378 32.2394C307.619 34.3308 308.87 35.7626 311.421 35.7626C313.459 35.7626 314.47 34.8778 314.919 33.9929C315.031 33.7838 315.256 33.6712 315.496 33.6712H320.293C320.678 33.6712 320.999 34.0251 320.903 34.4112C320.037 37.87 316.78 40.7819 311.421 40.7819C304.795 40.798 301.025 35.9717 301.025 29.9389ZM314.309 27.6866C314.71 27.6866 314.999 27.3166 314.919 26.9305C314.566 25.3057 313.411 24.1152 311.293 24.1152C308.999 24.1152 307.811 25.3057 307.459 26.9305C307.378 27.3166 307.667 27.6866 308.068 27.6866H314.309Z" fill="black"/>
            <path d="M324.015 19.4016H328.01C328.315 19.4016 328.572 19.6268 328.62 19.9164L329.021 22.4582H329.181C330.112 20.6081 331.861 19.0476 334.556 19.0476H336V24.7104H333.995C331.075 24.7104 329.181 26.6731 329.181 30.0515V39.8166C329.181 40.1545 328.909 40.4279 328.572 40.4279H324.032C323.695 40.4279 323.422 40.1545 323.422 39.8166V20.0129C323.406 19.6751 323.679 19.4016 324.015 19.4016Z" fill="black"/>
            <path d="M40.9592 17.9858L46.061 1.91441C46.3979 0.852638 45.8204 0 44.7615 0H26.7446C25.6857 0 24.5627 0.852638 24.2258 1.91441L19.1239 17.9698C18.787 19.0315 17.6639 19.8842 16.6051 19.8842H4.57241C3.51354 19.8842 2.39049 20.7368 2.05357 21.7986L0.112305 27.9118C-0.22461 28.9736 0.352958 29.8263 1.41183 29.8263H13.4445C14.5034 29.8263 15.0809 30.6789 14.744 31.7407L9.64217 47.796C9.30526 48.8578 9.88282 49.7104 10.9417 49.7104H28.9586C30.0175 49.7104 31.1405 48.8578 31.4774 47.796L36.5793 31.7246C36.9162 30.6628 36.3386 29.8102 35.2798 29.8102H17.2789C16.22 29.8102 15.6425 28.9575 15.9794 27.8958L17.9206 21.8147C18.2576 20.7529 19.3806 19.9003 20.4395 19.9003H38.4403C39.4992 19.9163 40.6223 19.0476 40.9592 17.9858Z" fill="#0000F4"/>
            </g>
            <defs>
            <clipPath id="clip0_3_74">
            <rect width="336" height="50" fill="white"/>
            </clipPath>
            </defs>
          </svg>
        </span>
      </Link>
      

      <div className="nav">
        <div className='nav-item'>
          {props.userAddress=="" && (<button className="nav-link btn btn-blue" onClick={() => connect(props.setUserAddress)} >Connect</button>) }
          {props.userAddress!="" && (<button className="nav-link btn btn-green" >Connected</button>)}
        </div>
      
      </div>
    </header>)
}
//{props.contractDetails.name && (<div>{props.contractDetails.name} ({props.contractDetails.symbol})</div>)}

export default Header;